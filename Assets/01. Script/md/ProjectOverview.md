# Hanam MC 프로젝트 코드 구조 문서

> 작성일: 2024년 12월
> 대상: PM / 기획자

---

## 1. 프로젝트 개요

**심리 교육 게임 애플리케이션**으로, 사용자가 10가지 문제를 풀면서 정서 지능을 발달시키는 구조입니다.

### 핵심 기능
- 회원가입/로그인 (BCrypt 암호화)
- 10개 문제 순차 진행 (Director 테마)
- 음성 인식 (STT) 기반 답변
- 인벤토리 아이템 획득 시스템
- 관리자 기능 (사용자 관리, 결과 조회)

---

## 2. 화면 흐름

```
┌─────────────────────────────────────────────────────────────┐
│                        앱 시작                               │
│                           ↓                                 │
│              ┌─────────────────────────┐                    │
│              │    로그인 여부 확인      │                    │
│              └─────────────────────────┘                    │
│                    ↓           ↓                            │
│              [로그인 안됨]   [로그인 됨]                      │
│                    ↓           ↓                            │
│         ┌──────────────┐  ┌──────────────┐                  │
│         │  로그인 화면  │  │   홈 화면    │                  │
│         │ (회원가입 탭) │  │ (문제 선택)  │                  │
│         └──────────────┘  └──────────────┘                  │
│                    ↓           ↓                            │
│              [로그인 성공]      │                            │
│                    ↓           ↓                            │
│              ┌─────────────────────────┐                    │
│              │       홈 화면           │                    │
│              │   - 문제 1~10 선택      │                    │
│              │   - 진행도 표시         │                    │
│              └─────────────────────────┘                    │
│                           ↓                                  │
│                    [문제 선택]                               │
│                           ↓                                  │
│              ┌─────────────────────────┐                    │
│              │      문제 풀이 화면      │                    │
│              │   Step1 → Step2 → Step3 │                    │
│              │         → 보상          │                    │
│              └─────────────────────────┘                    │
│                           ↓                                  │
│                    [문제 완료]                               │
│                           ↓                                  │
│              ┌─────────────────────────┐                    │
│              │       홈 화면           │                    │
│              │   (다음 문제 선택)       │                    │
│              └─────────────────────────┘                    │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 문제 구조 (Problem 1~10)

각 문제는 동일한 4단계 구조를 따릅니다:

| 단계 | 설명 | 예시 |
|------|------|------|
| **Step 1** | 도입/인트로 | 인벤토리 아이템 드래그 앤 드롭 |
| **Step 2** | 본 문제 | STT 음성 입력 또는 선택지 |
| **Step 3** | 마무리 | 결과 확인, 추가 선택 |
| **Reward** | 보상 획득 | 새 아이템 획득 애니메이션 |

### 문제별 특징

| 문제 | 주제 | 획득 아이템 | 특징 |
|------|------|-------------|------|
| 1 | 사실 vs 생각 구분 | 마음 렌즈 | 필름 카드, STT |
| 2 | 관점 선택 | 관점 렌즈 | 드래그 앤 드롭 |
| 3 | 시나리오 작성 | 시나리오 펜 | 인벤토리 사용 |
| 4 | 선택지 수행 | 가위 | 필름 편집 |
| 5 | 확대/축소 | 줌 렌즈 | 클로즈업 연출 |
| 6 | 호흡 명상 | 호흡 원 | 실시간 타이머 |
| 7 | 구두 선택 | 메가폰 | STT 입력 |
| 8 | 스토리보드 | 스토리보드 | 카드 플립 |
| 9 | 대본 사용 | 대본 | 갈등 해결 |
| 10 | 포스터 완성 | 영화 포스터 | 최종 작품 |

---

## 4. 코드 아키텍처

### 4.1 폴더 구조

```
Assets/01. Script/
├── Bootstrap.cs              # 앱 시작점
├── SessionManager.cs         # 로그인 세션 관리
├── SceneNavigator.cs         # 화면 전환
│
├── Data/                     # 데이터 레이어
│   ├── Model.cs              # 데이터 모델 정의
│   ├── DataService.cs        # 데이터 접근 허브
│   ├── Repository/           # DB CRUD
│   └── Local*Service.cs      # 비즈니스 로직
│
├── ProblemScene/             # 문제 풀이
│   ├── Director/Problem1~10/ # 각 문제별 코드
│   │   ├── Binder/           # UI 연결
│   │   └── Logic/            # 로직
│   └── StepBases/            # 공통 베이스 클래스
│
├── HomeScene/                # 홈 화면
├── RegisterScene/            # 로그인/회원가입
├── Effect/                   # 애니메이션 효과
├── Inventory/                # 인벤토리 시스템
└── STT/                      # 음성 인식
```

### 4.2 핵심 설계 패턴

#### Binder / Logic 패턴
```
Director_Problem1_Step1 (Binder)
    - UI 요소 연결 (Inspector에서 할당)
    - 설정값 제공
         ↓ 상속
Director_Problem1_Step1_Logic (Logic)
    - 실제 게임 로직
    - 이벤트 처리
         ↓ 상속
ProblemStepBase (Base)
    - 데이터 저장
    - 공통 기능
```

#### 데이터 접근 패턴
```
UI/Script
    ↓
Service (비즈니스 로직)
    ↓
Repository (CRUD)
    ↓
DBGateway (LiteDB 래핑)
    ↓
mc.db 파일
```

---

## 5. 주요 시스템

### 5.1 인벤토리 시스템

- 각 문제 완료 시 **아이템 획득**
- 다음 문제에서 **획득한 아이템 사용** (드래그 앤 드롭)
- 10개 문제 완료 시 모든 아이템 수집

```
[인벤토리 흐름]
문제 1 완료 → "마음 렌즈" 획득
    ↓
문제 2 시작 → "마음 렌즈"를 드롭존에 드래그
    ↓
문제 2 완료 → "시나리오 펜" 획득
    ↓
... (반복)
```

### 5.2 STT (음성 인식) 시스템

- **Whisper AI** 기반 한국어 음성 인식
- 실시간 부분 결과 표시
- 키워드 매칭으로 정답 판정

=> 다만 이방식은 10번문제 로직상 유저의 음성을 그대로 텍스트로반환해서 출력해야하는부분에 있어서 애매한 부분 보임임
```
[STT 흐름]
마이크 버튼 클릭
    ↓
음성 녹음 시작
    ↓
Whisper 모델 처리
    ↓
텍스트 결과 반환
    ↓
키워드 매칭 (정답 확인)
```

### 5.3 애니메이션 시스템

- **DOTween** 라이브러리 사용
- 공통 효과: 슬라이드, 페이드, 스케일, 글로우
- 문제별 특수 효과: 파티클, 카드 플립, 호흡 원

---

## 6. 데이터 저장

### 6.1 저장되는 데이터

| 데이터 | 설명 | 저장 시점 |
|--------|------|----------|
| **User** | 사용자 정보 | 회원가입 시 |
| **Attempt** | 각 Step 시도 기록 | Step 진입 시 |
| **ResultDoc** | 문제 완료 결과 | 문제 완료 시 |
| **InventoryItem** | 획득 아이템 | 보상 획득 시 |

### 6.2 데이터 흐름

```
[Step 진입]
OnStepEnter() 호출
    ↓
SaveAttempt() - DB에 시도 기록

[문제 완료]
CommonRewardStep 활성화
    ↓
SaveReward() - 아이템 지급
    ↓
MarkProblemSolved() - 결과 저장
```

---

## 7. 권한 시스템

| 권한 | 설명 | 접근 가능 기능 |
|------|------|----------------|
| **USER** | 일반 사용자 | 문제 풀이, 인벤토리 |
| **ADMIN** | 관리자 | + 사용자 검색, 결과 조회 |
| **SUPERADMIN** | 최고 관리자 | + 권한 변경 |

```
[로그인 후 화면 분기]
USER → 홈 화면 (문제 선택)
ADMIN/SUPERADMIN → 결과 화면 (관리자 패널)
```

---

## 8. 기술 스택

| 영역 | 기술 |
|------|------|
| 엔진 | Unity 2022.3 LTS |
| 언어 | C# |
| 데이터베이스 | LiteDB (로컬) |
| 애니메이션 | DOTween |
| 음성 인식 | OpenAI Whisper |
| 암호화 | BCrypt |

---

## 9. 핵심 파일 요약

### 시작/관리
| 파일 | 역할 |
|------|------|
| `Bootstrap.cs` | 앱 시작, DB 초기화 |
| `SessionManager.cs` | 로그인 상태 관리 |
| `SceneNavigator.cs` | 화면 전환 |
| `DataService.cs` | 데이터 접근 허브 |

### 문제 풀이
| 파일 | 역할 |
|------|------|
| `ProblemSceneController.cs` | 문제 씬 라우팅 |
| `StepFlowController.cs` | Step 순서 제어 |
| `ProblemStepBase.cs` | 모든 Step의 부모 |
| `StepCompletionGate.cs` | 완료 조건 체크 |

### 효과/UI
| 파일 | 역할 |
|------|------|
| `EffectControllerBase.cs` | 애니메이션 베이스 |
| `StepInventoryPanel.cs` | 인벤토리 UI |
| `STTManager.cs` | 음성 인식 |

---

## 10. 확장 가이드

### 새 문제 추가 시

1. `Director/Problem[N]/` 폴더 생성
2. `Binder/Director_Problem[N]_Step1~3.cs` 생성
3. `Logic/Director_Problem[N]_Step1~3_Logic.cs` 생성
4. `Effect/Problem[N]/` 이펙트 컨트롤러 생성
5. Unity 씬에서 UI 구성 및 연결

### 새 아이템 추가 시

1. `CommonRewardStep`의 `rewardItemId`, `rewardItemName` 설정
2. `StepInventoryPanel` 슬롯 추가
3. `RewardInventoryPanel` 슬롯 추가

---

## 11. 문의

코드 관련 질문이나 수정 요청은 개발팀에 문의해주세요.
